{
  "hash": "d3557c90ed7d06051dd344665b2a3e81",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home_Ex3\"\nauthor: \"Enrico Limberg\"\ndate: \"March 20, 2025\"\ndate-modified: \"last-modified\"\nexecute:\n    echo: true\n    eval: true\n    warning: false\n    freeze: true\n---\n\n\n\n# Prototyping Modules for Visual Analytics Shiny Application\n\n# 1.0 Install and Load R packages\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse,tsibble,feasts,fable,seasonal,tidymodels,timetk,modeltime,forecast,ggplot2,tidyr,dplyr,lubridate,tsibble)\n```\n:::\n\n\n\n# 2.0 Import Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweather <- read_csv(\"data/weather.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(weather)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 6,222\nColumns: 13\n$ station                     <chr> \"Paya Lebar\", \"Paya Lebar\", \"Paya Lebar\", …\n$ year                        <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, …\n$ month                       <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …\n$ day                         <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,…\n$ daily_rainfall_total_mm     <dbl> 21.6, 0.0, 1.6, 63.8, 4.4, 3.0, 59.8, 0.0,…\n$ highest_30_min_rainfall_mm  <dbl> 9.2, 0.0, 1.6, 13.8, 1.6, 3.0, 15.4, 0.0, …\n$ highest_60_min_rainfall_mm  <dbl> 13.2, 0.0, 1.6, 19.8, 3.0, 3.0, 17.4, 0.0,…\n$ highest_120_min_rainfall_mm <dbl> 14.6, 0.0, 1.6, 26.6, 3.2, 3.0, 21.8, 0.0,…\n$ mean_temperature_c          <dbl> 25.9, 27.8, 27.7, 25.0, 26.8, 28.1, 24.6, …\n$ maximum_temperature_c       <dbl> 28.8, 32.6, 32.6, 26.9, 30.8, 33.1, 27.3, …\n$ minimum_temperature_c       <dbl> 24.5, 24.2, 25.5, 23.7, 24.5, 24.9, 23.5, …\n$ mean_wind_speed_km_h        <dbl> 6.5, 7.0, 7.1, 7.2, 8.4, 7.6, 4.9, 8.5, 7.…\n$ max_wind_speed_km_h         <dbl> 24.1, 31.5, 29.6, 25.9, 35.2, 27.8, 18.5, …\n```\n\n\n:::\n:::\n\n\n\n# 3.0 Data Wrangling\n\n## 3.1 Convert year, month, and day into single date column\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweather <- weather %>%\n  mutate(date = make_date(year, month, day)) %>%\n  arrange(date)\n```\n:::\n\n\n\n## 3.2 Remove missing values\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweather <- weather %>% \n  drop_na()\n```\n:::\n\n\n\n## 3.3 Convert to time-series format\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data <- weather %>%\n  as_tsibble(index = date, key = station) %>%\n  fill_gaps()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 5,216 x 14 [1D]\n# Key:       station [16]\n   station    year month   day daily_rainfall_total_mm highest_30_min_rainfall…¹\n   <chr>     <dbl> <dbl> <dbl>                   <dbl>                     <dbl>\n 1 Admiralty  2024     1     1                     8.5                       2  \n 2 Admiralty  2024     1     2                     0.5                       0.5\n 3 Admiralty  2024     1     3                     1.5                       1.5\n 4 Admiralty  2024     1     4                    67.6                      10.6\n 5 Admiralty  2024     1     5                     5.4                       2.2\n 6 Admiralty  2024     1     6                     0.8                       0.8\n 7 Admiralty  2024     1     7                    69.6                      17.4\n 8 Admiralty  2024     1     8                     1.6                       1.2\n 9 Admiralty  2024     1     9                    49                        17.2\n10 Admiralty  2024     1    10                    63.2                      17.4\n# ℹ 5,206 more rows\n# ℹ abbreviated name: ¹​highest_30_min_rainfall_mm\n# ℹ 8 more variables: highest_60_min_rainfall_mm <dbl>,\n#   highest_120_min_rainfall_mm <dbl>, mean_temperature_c <dbl>,\n#   maximum_temperature_c <dbl>, minimum_temperature_c <dbl>,\n#   mean_wind_speed_km_h <dbl>, max_wind_speed_km_h <dbl>, date <date>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(ts_data, \"ts_data.csv\")\n```\n:::\n\n\n\n## 3.4 Convert to time-series (weekly aggregation)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data_weekly <- weather %>%\n  as_tsibble(index = date, key = station) %>%\n  fill_gaps() %>%\n  mutate(week = floor_date(date, \"week\")) %>%\n  group_by(station, week) %>%\n  summarise(\n    mean_temp = mean(mean_temperature_c, na.rm = TRUE), \n    max_temp = if_else(any(!is.na(mean_temperature_c)), max(mean_temperature_c, na.rm = TRUE), NA_real_),    \n    min_temp = if_else(any(!is.na(mean_temperature_c)), min(mean_temperature_c, na.rm = TRUE), NA_real_),\n    total_rainfall = sum(daily_rainfall_total_mm, na.rm = TRUE)\n  ) %>%\n  ungroup() %>%\n  distinct(station, week, .keep_all = TRUE) %>%\n  as_tsibble(index = week, key = station)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data_weekly$mean_temp[is.nan(ts_data_weekly$mean_temp)] <- NA\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data_weekly\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 757 x 7 [7D]\n# Key:       station [16]\n   station   week       date       mean_temp max_temp min_temp total_rainfall\n   <chr>     <date>     <date>         <dbl>    <dbl>    <dbl>          <dbl>\n 1 Admiralty 2023-12-31 2024-01-01      25.6     25.6     25.6            8.5\n 2 Admiralty 2024-01-07 2024-01-07      24       24       24             69.6\n 3 Admiralty 2024-01-14 2024-01-14      27.3     27.3     27.3            0  \n 4 Admiralty 2024-01-21 2024-01-21      27.2     27.2     27.2            0  \n 5 Admiralty 2024-01-28 2024-01-28      27.5     27.5     27.5            0  \n 6 Admiralty 2024-02-04 2024-02-04      28.3     28.3     28.3            0  \n 7 Admiralty 2024-02-11 2024-02-11      27.6     27.6     27.6            0  \n 8 Admiralty 2024-02-18 2024-02-18      27.9     27.9     27.9            0  \n 9 Admiralty 2024-02-25 2024-02-25      28.4     28.4     28.4            0  \n10 Admiralty 2024-03-03 2024-03-03      26.3     26.3     26.3           34.2\n# ℹ 747 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(ts_data_weekly, \"ts_data_weekly.csv\")\n```\n:::\n\n\n\n# 4.0 Time-Series Visualization\n\n## 4.1 Single time-series (daily)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data %>%\n  filter(station == \"Paya Lebar\") %>%\n  ggplot(aes(x = date,\n             y = mean_temperature_c))+\n  geom_line(size = 0.5)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n## 4.2 Time Series (Weekly)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data_weekly %>%\n  filter(station == \"Paya Lebar\") %>%\n  ggplot(aes(x = week,\n             y = mean_temp))+\n  geom_line(size = 0.5)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n## 4.3 Multiple time-series\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ts_data,\n       aes(x = date,\n           y = mean_temperature_c,\n           color = station))+\n  geom_line(size = 0.5) +\n  theme(legend.position = \"bottom\",\n        legend.box.spacing = unit(0.5, \"cm\"))+\n  labs(title = \"Mean Temperature Over Time\", y = \"Temperature (°C)\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ts_data_weekly,\n       aes(x = week,\n           y = mean_temp,\n           color = station))+\n  geom_line(size = 0.5) +\n  theme(legend.position = \"bottom\",\n        legend.box.spacing = unit(0.5, \"cm\"))+\n  labs(title = \"Mean Temperature Over Time (Weekly)\", y = \"Temperature (°C)\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n## 4.4 facet_wrap() for effective comparison of multiple line graph\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ts_data, \n       aes(x = date, \n           y = mean_temperature_c))+\n  geom_line(size = 0.5) +\n  facet_wrap(~ station,\n             ncol = 3,\n             scales = \"free_y\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n# 5.0 Visual Analysis of Time-series data\n\n## 5.1 Seasonality with seasonal plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data %>%\n  filter(station == \"Admiralty\" |\n         station == \"Paya Lebar\" |\n         station == \"Clementi\" |\n         station == \"Changi\") %>% \n  fill_gaps() %>%\n  gg_season(mean_temperature_c)+\n  labs(title = \"Seasonal Plot\", y = \"Temperature (°C)\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n## 5.2 Cycle Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data %>%\n  filter(station == \"Admiralty\" |\n         station == \"Changi\") %>% \n  autoplot(mean_temperature_c) + \n  facet_grid(station ~ ., scales = \"free_y\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n```         \n```\n\n# 6.0 Time series decomposition\n\n## 6.1 ACF plot of Daily Mean Temperature\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data %>%\n  filter(station == \"Changi\") %>%\n  ACF(mean_temperature_c) %>%\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n## 6.2 PACF plot of Daily Mean Temperature\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data %>%\n  filter(station == \"Changi\") %>%\n  PACF(mean_temperature_c) %>%\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n# 7.0 STL Decomposition\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data <- ts_data %>%\n  fill_gaps() %>%\n  mutate(mean_temperature_c = na.interp(mean_temperature_c))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data %>% count(is.na(mean_temperature_c))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  `is.na(mean_temperature_c)`     n\n  <lgl>                       <int>\n1 FALSE                        5216\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data %>%\n  filter(!is.na(mean_temperature_c)) %>%\n  model(STL(mean_temperature_c ~ season(window = \"periodic\"))) %>%\n  components() %>%\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n# 8.0 Visual Forecasting\n\n## 8.1 Data Sampling\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_ts <- ts_data %>%\n  filter(station == \"Changi\") %>% \n  mutate(Type = if_else(\n    date >= \"2024-10-01\", \n    \"Hold-out\", \"Training\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_train <- Changi_ts %>%\n  filter(date < \"2024-10-01\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_train %>% fill_gaps()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 274 x 15 [1D]\n# Key:       station [1]\n   station  year month   day daily_rainfall_total_mm highest_30_min_rainfall_mm\n   <chr>   <dbl> <dbl> <dbl>                   <dbl>                      <dbl>\n 1 Changi   2024     1     1                    49.6                       24.6\n 2 Changi   2024     1     2                     0.4                        0.4\n 3 Changi   2024     1     3                     8.8                        8.2\n 4 Changi   2024     1     4                    80.6                       17.6\n 5 Changi   2024     1     5                     4.2                        3  \n 6 Changi   2024     1     6                     0.6                        0.6\n 7 Changi   2024     1     7                    64                         12.8\n 8 Changi   2024     1     8                     0                          0  \n 9 Changi   2024     1     9                     2.6                        0.8\n10 Changi   2024     1    10                    63.2                       19  \n# ℹ 264 more rows\n# ℹ 9 more variables: highest_60_min_rainfall_mm <dbl>,\n#   highest_120_min_rainfall_mm <dbl>, mean_temperature_c <dbl>,\n#   maximum_temperature_c <dbl>, minimum_temperature_c <dbl>,\n#   mean_wind_speed_km_h <dbl>, max_wind_speed_km_h <dbl>, date <date>,\n#   Type <chr>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_train_imputed <- Changi_train %>%\n  mutate(mean_temperature_c = zoo::na.approx(mean_temperature_c))\n\nChangi_train_imputed %>%\n  model(stl = STL(mean_temperature_c)) %>%\n  components() %>%\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n\n\n## 8.2 Fitting Forecasting Model\n\n### 8.2.1 Fitting ETS Model\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nETS(y ~ error(c(\"A\", \"M\")) \n    + trend(c(\"N\", \"A\", \"Ad\")) \n    + season(c(\"N\", \"A\", \"M\"))\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<ETS model definition>\n```\n\n\n:::\n:::\n\n\n\n### 8.2.2 Fitting simple ETS\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nses <- Changi_train_imputed %>%\n  model(ETS(mean_temperature_c ~ error(\"A\") \n            + trend(\"N\") \n            + season(\"N\")))\nses\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A mable: 1 x 2\n# Key:     station [1]\n  station `ETS(mean_temperature_c ~ error(\"A\") + trend(\"N\") + season(\"N\"))`\n  <chr>                                                             <model>\n1 Changi                                                       <ETS(A,N,N)>\n```\n\n\n:::\n:::\n\n\n\n### 8.2.3 Check model assumptions\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_tsresiduals(ses)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n\n### 8.2.4 Model's report\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nses %>%\n  report()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: mean_temperature_c \nModel: ETS(A,N,N) \n  Smoothing parameters:\n    alpha = 0.2852897 \n\n  Initial states:\n     l[0]\n 26.32362\n\n  sigma^2:  0.7308\n\n     AIC     AICc      BIC \n1456.047 1456.136 1466.887 \n```\n\n\n:::\n:::\n\n\n\n### 8.2.5 Holt's Linear Method\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_Holt <- Changi_train_imputed %>%\n  model(`Holt's method` = \n          ETS(mean_temperature_c ~ error(\"A\") +\n                trend(\"A\") + \n                season(\"N\")))\nChangi_Holt %>% report()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: mean_temperature_c \nModel: ETS(A,A,N) \n  Smoothing parameters:\n    alpha = 0.2807998 \n    beta  = 0.0001000422 \n\n  Initial states:\n     l[0]        b[0]\n 26.28793 0.008576169\n\n  sigma^2:  0.7356\n\n     AIC     AICc      BIC \n1459.812 1460.036 1477.878 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_tsresiduals(Changi_Holt)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n\n\n### 8.2.6 Holt-Winters\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_HW <- Changi_train_imputed %>%\n  model(\n    Additive = ETS(mean_temperature_c ~ error(\"A\") \n                   + trend(\"A\") \n                   + season(\"A\")),\n    Multiplicative = ETS(mean_temperature_c ~ error(\"M\") \n                         + trend(\"A\") \n                         + season(\"M\"))\n    )\n\nChangi_HW %>% report()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 10\n  station .model           sigma2 log_lik   AIC  AICc   BIC   MSE  AMSE    MAE\n  <chr>   <chr>             <dbl>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>  <dbl>\n1 Changi  Additive       0.738      -722. 1467. 1469. 1511. 0.708 0.793 0.653 \n2 Changi  Multiplicative 0.000962   -731. 1486. 1487. 1529. 0.755 0.813 0.0237\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_ETS <- Changi_train_imputed %>%\n  model(`SES` = ETS(mean_temperature_c ~ error(\"A\") + \n                      trend(\"N\") + \n                      season(\"N\")),\n        `Holt`= ETS(mean_temperature_c ~ error(\"A\") +\n                      trend(\"A\") +\n                      season(\"N\")),\n        `damped Holt` = \n          ETS(mean_temperature_c ~ error(\"A\") +\n                trend(\"Ad\") + \n                season(\"N\")),\n        `WH_A` = ETS(\n          mean_temperature_c ~ error(\"A\") + \n            trend(\"A\") + \n            season(\"A\")),\n        `WH_M` = ETS(mean_temperature_c ~ error(\"M\") \n                         + trend(\"A\") \n                         + season(\"M\"))\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_ETS %>%\n  tidy()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 35 × 4\n   station .model      term   estimate\n   <chr>   <chr>       <chr>     <dbl>\n 1 Changi  SES         alpha  0.285   \n 2 Changi  SES         l[0]  26.3     \n 3 Changi  Holt        alpha  0.281   \n 4 Changi  Holt        beta   0.000100\n 5 Changi  Holt        l[0]  26.3     \n 6 Changi  Holt        b[0]   0.00858 \n 7 Changi  damped Holt alpha  0.279   \n 8 Changi  damped Holt beta   0.000100\n 9 Changi  damped Holt phi    0.976   \n10 Changi  damped Holt l[0]  25.8     \n# ℹ 25 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_ETS %>% \n  report()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 10\n  station .model        sigma2 log_lik   AIC  AICc   BIC   MSE  AMSE    MAE\n  <chr>   <chr>          <dbl>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>  <dbl>\n1 Changi  SES         0.731      -725. 1456. 1456. 1467. 0.725 0.817 0.659 \n2 Changi  Holt        0.736      -725. 1460. 1460. 1478. 0.725 0.815 0.653 \n3 Changi  damped Holt 0.735      -724. 1461. 1461. 1482. 0.722 0.810 0.648 \n4 Changi  WH_A        0.738      -722. 1467. 1469. 1511. 0.708 0.793 0.653 \n5 Changi  WH_M        0.000962   -731. 1486. 1487. 1529. 0.755 0.813 0.0237\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_ETS %>%\n  forecast(h = \"30 days\") %>%\n  autoplot(Changi_train_imputed, \n           level = NULL)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_autoETS <- Changi_train_imputed %>%\n  model(ETS(mean_temperature_c))\nfit_autoETS %>% report()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: mean_temperature_c \nModel: ETS(A,N,N) \n  Smoothing parameters:\n    alpha = 0.2852897 \n\n  Initial states:\n     l[0]\n 26.32362\n\n  sigma^2:  0.7308\n\n     AIC     AICc      BIC \n1456.047 1456.136 1466.887 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngg_tsresiduals(fit_autoETS)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n\n\n\n### 8.2.7 Forecasting future values\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_autoETS %>%\n  forecast(h = \"30 days\") %>%\n  autoplot(Changi_train_imputed)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\n\n### 8.2.8 **Visualising AutoETS model with ggplot2**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfc_autoETS <- fit_autoETS %>%\n  forecast(h = \"30 days\")\n\nChangi_train_imputed %>%\n  ggplot(aes(x=`date`, \n             y=mean_temperature_c)) +\n  autolayer(fc_autoETS, \n            alpha = 0.6) +\n  geom_line(aes(\n    color = Type), \n    alpha = 0.8) + \n  geom_line(aes(\n    y = .mean, \n    colour = \"Forecast\"), \n    data = fc_autoETS) +\n  geom_line(aes(\n    y = .fitted, \n    colour = \"Fitted\"), \n    data = augment(fit_autoETS))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n\n\n# 9.0 ARIMA Method\n\n## 9.1 Fitting ARIMA model\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_autoARIMA <- Changi_train_imputed %>%\n  model(ARIMA(mean_temperature_c))\nreport(fit_autoARIMA)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: mean_temperature_c \nModel: ARIMA(1,1,3)(2,0,0)[7] \n\nCoefficients:\n          ar1     ma1      ma2      ma3     sar1     sar2\n      -0.9599  0.4075  -0.7461  -0.2559  -0.0670  -0.1490\ns.e.   0.0364  0.0694   0.0525   0.0632   0.0676   0.0647\n\nsigma^2 estimated as 0.6832:  log likelihood=-333.01\nAIC=680.02   AICc=680.44   BIC=705.29\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_training <- Changi_train_imputed %>% filter(Type == \"Training\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_multi <- Changi_training %>%\n  model(\n    ets = ETS(mean_temperature_c),\n    arima = ARIMA(mean_temperature_c)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_multi %>%\n  glance()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 12\n  station .model sigma2 log_lik   AIC  AICc   BIC    MSE   AMSE    MAE ar_roots\n  <chr>   <chr>   <dbl>   <dbl> <dbl> <dbl> <dbl>  <dbl>  <dbl>  <dbl> <list>  \n1 Changi  ets     0.731   -725. 1456. 1456. 1467.  0.725  0.817  0.659 <NULL>  \n2 Changi  arima   0.683   -333.  680.  680.  705. NA     NA     NA     <cpl>   \n# ℹ 1 more variable: ma_roots <list>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_forecast <- Changi_multi %>%\n  forecast(h = \"30 days\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nChangi_forecast %>%\n  autoplot(Changi_training)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-49-1.png){width=672}\n:::\n:::\n\n\n\n## 9.2 Multi station ARIMA\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_data %>% model(ARIMA(mean_temperature_c)) %>%\n  forecast(h = \"7 days\") %>% \n  autoplot(ts_data)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex3_files/figure-html/unnamed-chunk-50-1.png){width=960}\n:::\n:::\n",
    "supporting": [
      "Take-home_Ex3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}