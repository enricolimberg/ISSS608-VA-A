---
title: "Take-home_Ex3"
author: "Enrico Limberg"
date: "March 20, 2025"
date-modified: "last-modified"
execute:
    echo: true
    eval: true
    warning: false
    freeze: true
---

```{r}
library(tidyverse)
library(lubridate)
library(fable)
library(tsibble)
library(ggplot2)

# Load and preprocess data
weather_data <- read.csv("data/weather.csv") %>%
  mutate(date = as.Date(paste(year, month, day, sep = "-"))) %>%
  mutate(across(where(is.numeric), ~ifelse(is.na(.), mean(., na.rm = TRUE), .)))

# Convert to tsibble (time-series format)
weather_ts <- weather_data %>%
  as_tsibble(index = date, key = station)


```

```{r}
# Print first few rows
head(weather_data)
```

```{r}
# Define a station to analyze
selected_station <- "Changi"

# Define a variable to forecast
selected_var <- "mean_temperature_c"

# Filter last 3 months
filtered_data <- weather_ts %>%
  filter(station == selected_station & date >= max(date) - months(3))

# Plot the past 3 months of data
ggplot(filtered_data, aes(x = date, y = .data[[selected_var]])) +
  geom_line(color = "blue") +
  labs(title = paste("Last 3 Months of", selected_var, "at", selected_station),
       x = "Date", y = selected_var) +
  theme_minimal()
```

```{r}
# Ensure there are enough data points
nrow(filtered_data)
# Check for NA values
sum(is.na(filtered_data[[selected_var]]))
filtered_data <- filtered_data %>%
  mutate(across(where(is.numeric), ~ifelse(is.na(.), mean(., na.rm = TRUE), .)))
```

```{r}
str(filtered_data)

```

```{r}
filtered_data <- filtered_data %>%
  mutate(!!selected_var := as.numeric(.data[[selected_var]]))

```
